
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Cricket Oracle platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "User's display name."
        }
      },
      "required": [
        "id",
        "email",
        "username"
      ]
    },
    "CricketSeries": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CricketSeries",
      "type": "object",
      "description": "Represents a Cricket Series fetched from the Cricapi API.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the cricket series."
        },
        "name": {
          "type": "string",
          "description": "Name of the cricket series."
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the cricket series.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the cricket series.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "startDate",
        "endDate"
      ]
    },
    "Match": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Match",
      "type": "object",
      "description": "Represents a cricket match within a series.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the match."
        },
        "seriesId": {
          "type": "string",
          "description": "Reference to CricketSeries. (Relationship: CricketSeries 1:N Match)"
        },
        "team1": {
          "type": "string",
          "description": "Name of the first team in the match."
        },
        "team2": {
          "type": "string",
          "description": "Name of the second team in the match."
        },
        "matchStart": {
          "type": "string",
          "description": "Start date and time of the match.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "seriesId",
        "team1",
        "team2",
        "matchStart"
      ]
    },
    "Prediction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Prediction",
      "type": "object",
      "description": "Represents a user's prediction for a specific match.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the prediction."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Prediction)"
        },
        "matchId": {
          "type": "string",
          "description": "Reference to Match. (Relationship: Match 1:N Prediction)"
        },
        "predictedWinner": {
          "type": "string",
          "description": "The team the user predicts will win."
        },
        "predictionTime": {
          "type": "string",
          "description": "Time when the prediction was made.",
          "format": "date-time"
        },
        "isCorrect": {
          "type": "boolean",
          "description": "Indicates if the prediction was correct."
        }
      },
      "required": [
        "id",
        "userId",
        "matchId",
        "predictedWinner",
        "predictionTime"
      ]
    }
  },
  "auth": {
    "providers": [
      "emailLink",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Path-based ownership ensures only the user can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/cricketSeries/{seriesId}",
        "definition": {
          "entityName": "CricketSeries",
          "schema": {
            "$ref": "#/backend/entities/CricketSeries"
          },
          "description": "Stores cricket series data fetched from the Cricapi API. No ownership; accessible to all users.",
          "params": [
            {
              "name": "seriesId",
              "description": "The unique identifier for the cricket series."
            }
          ]
        }
      },
      {
        "path": "/cricketSeries/{seriesId}/matches/{matchId}",
        "definition": {
          "entityName": "Match",
          "schema": {
            "$ref": "#/backend/entities/Match"
          },
          "description": "Stores match data for a specific cricket series. No ownership; accessible to all users.",
          "params": [
            {
              "name": "seriesId",
              "description": "The unique identifier for the cricket series."
            },
            {
              "name": "matchId",
              "description": "The unique identifier for the match."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/predictions/{predictionId}",
        "definition": {
          "entityName": "Prediction",
          "schema": {
            "$ref": "#/backend/entities/Prediction"
          },
          "description": "Stores user predictions for matches. Path-based ownership, with userId denormalized into the document to ensure authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "predictionId",
              "description": "The unique identifier for the prediction."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Cricket Oracle application's features, focusing on user authentication, prediction storage, leaderboard functionality, and integration with the Cricapi API. The design emphasizes security, scalability, and maintainability, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. User authentication is handled through Firebase Authentication (password and anonymous). The database structure organizes data related to users, cricket series, matches, and predictions, enabling efficient querying and secure data access.\n\nAuthorization Independence is achieved by denormalizing the `userId` into the `Prediction` documents, avoiding the need for `get()` calls in security rules to verify user ownership. The structure uses path-based ownership for user-specific data (predictions under `/users/{userId}/predictions/{predictionId}`), making security rules straightforward and efficient. Segregation of data is maintained by storing different entities in separate collections, ensuring a homogeneous security posture within each collection. The structure enables secure list operations (QAPs) by directly associating predictions with users via the path and leveraging the user ID in the security rules. This design promotes clear authorization intent, simplifies debugging, and supports the application's core features in a secure and scalable manner."
  }
}
